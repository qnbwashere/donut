<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Launcher</title>
<style>
body{
  margin:0;
  background:#0f1115;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:system-ui;
}
button{
  padding:18px 40px;
  font-size:18px;
  background:#4da3ff;
  border:none;
  border-radius:8px;
  color:white;
  cursor:pointer;
}
button:hover{opacity:.8;}
</style>
</head>
<body>

<button onclick="launch()">Launch Game</button>

<script>
function launch(){

  const popup = window.open(
    "",
    "_blank",
    "width=1200,height=800,menubar=no,toolbar=no,location=no,status=no,resizable=yes"
  );

  popup.document.write(`
  <!doctype html>
  <html>
  <head>
  <meta charset="utf-8">
  <title>Game</title>
  <style>
  body{margin:0;background:#0f1115;font-family:system-ui;color:white;display:flex;justify-content:center;padding:20px;}
  #layout{display:flex;gap:20px;flex-wrap:wrap;}
  #game-box{position:relative;width:640px;height:480px;background:black;overflow:hidden;border-radius:10px;}
  #game-box.fullscreen{position:fixed;inset:0;width:100vw;height:100vh;border-radius:0;z-index:999;display:flex;align-items:center;justify-content:center;}
  iframe{width:640px;height:480px;border:0;transform-origin:center center;display:block;}
  #overlay{position:absolute;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;}
  #overlay button{padding:16px 30px;font-size:18px;background:#4da3ff;border:none;border-radius:8px;color:white;cursor:pointer;}
  #panel{width:300px;background:#1a1d24;padding:15px;border-radius:10px;}
  .setting{margin-bottom:16px;}
  button{background:#2a2f3a;border:none;color:white;padding:6px 10px;margin:4px 4px 0 0;cursor:pointer;border-radius:5px;}
  button.active{background:#4da3ff;}
  input[type=range]{width:100%;}
  .low-motion *{animation:none !important;transition:none !important;}
  </style>
  </head>
  <body>

  <div id="layout">

    <div id="game-box">
      <iframe id="game" src="about:blank"></iframe>
      <div id="overlay">
        <button id="startBtn">Start Game</button>
      </div>
    </div>

    <div id="panel">

      <div class="setting">
        <label>Resolution</label>
        <input id="resSlider" type="range" min="0.5" max="1" step="0.01" value="1">
        <div id="resLabel">100%</div>
      </div>

      <div class="setting">
        <label>FPS Cap</label><br>
        <button id="fps30">30</button>
        <button id="fps60">60</button>
        <button id="fps120">120</button>
        <button id="fpsUnlimited">Unlimited</button>
      </div>

      <div class="setting">
        <button id="toggleAnim">Disable Animations</button>
        <button id="fullscreenBtn">Fullscreen</button>
      </div>

      <div>FPS: <span id="fps">0</span></div>

    </div>
  </div>

  <script>
  const gameBox=document.getElementById("game-box");
  const game=document.getElementById("game");
  const slider=document.getElementById("resSlider");
  const label=document.getElementById("resLabel");
  let baseScale=1;
  let isFullscreen=false;
  let fpsCap=0,lastFrame=0,frames=0,lastUpdate=performance.now();

  document.getElementById("startBtn").onclick=()=>{
    game.src="https://archive.org/embed/papasdonuteria_102";
    document.getElementById("overlay").style.display="none";
  };

  slider.oninput=function(){
    baseScale=parseFloat(this.value);
    label.textContent=Math.round(baseScale*100)+"%";
    applyScale();
  };

  function applyScale(){
    if(!isFullscreen){
      game.style.transform="scale("+baseScale+")";
      return;
    }
    const fit=Math.min(window.innerWidth/640,window.innerHeight/480);
    game.style.transform="scale("+(fit*(1/baseScale))+")";
  }

  window.addEventListener("resize",applyScale);

  fullscreenBtn.onclick=function(){
    isFullscreen=!isFullscreen;
    gameBox.classList.toggle("fullscreen");
    this.classList.toggle("active");
    applyScale();
  };

  function setFPS(limit,btn){
    fpsCap=limit;
    document.querySelectorAll("[id^='fps']").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
  }

  fps30.onclick=e=>setFPS(30,e.target);
  fps60.onclick=e=>setFPS(60,e.target);
  fps120.onclick=e=>setFPS(120,e.target);
  fpsUnlimited.onclick=e=>setFPS(0,e.target);

  function loop(now){
    if(!fpsCap||now-lastFrame>=1000/fpsCap){
      lastFrame=now;
      frames++;
    }
    if(now-lastUpdate>=1000){
      document.getElementById("fps").textContent=frames;
      frames=0;
      lastUpdate=now;
    }
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
  <\/script>

  </body>
  </html>
  `);

  popup.document.close();

  // Clear original tab
  document.body.innerHTML="";
  document.title="";
}
</script>

</body>
</html>
