<script>

const game = document.getElementById("game");
const box = document.getElementById("game-box");

const BASE_WIDTH = 640;
const BASE_HEIGHT = 480;

let baseScale = 1;
let fpsCap = 60;
let lastFrame = 0;
let frames = 0;
let lastUpdate = performance.now();
let isFullscreen = false;

function updateScale(){
  let finalScale = baseScale;

  if(isFullscreen){
    const fit = Math.min(
      window.innerWidth / BASE_WIDTH,
      window.innerHeight / BASE_HEIGHT
    );
    finalScale = fit * baseScale;
  }

  game.style.transform = `scale(${finalScale})`;
}

document.getElementById("scale").oninput = function(){
  baseScale = parseFloat(this.value);
  updateScale();
};

document.getElementById("fpsCap").onchange = function(){
  fpsCap = parseInt(this.value);
};

document.getElementById("fullscreen").onclick = function(){
  isFullscreen = !isFullscreen;
  box.classList.toggle("fullscreen", isFullscreen);
  updateScale();
};

window.addEventListener("resize", updateScale);

document.getElementById("toggleAnim").onclick = function(){
  document.body.classList.toggle("low-motion");
};

document.getElementById("perf").onclick = function(){
  baseScale = 0.7;
  fpsCap = 60;
  document.body.classList.add("low-motion");
  syncUI();
};

document.getElementById("balanced").onclick = function(){
  baseScale = 0.85;
  fpsCap = 60;
  document.body.classList.remove("low-motion");
  syncUI();
};

document.getElementById("quality").onclick = function(){
  baseScale = 1;
  fpsCap = 0;
  document.body.classList.remove("low-motion");
  syncUI();
};

function syncUI(){
  document.getElementById("scale").value = baseScale;
  document.getElementById("fpsCap").value = fpsCap;
  updateScale();
}

function loop(now){
  if(!fpsCap || now - lastFrame >= 1000 / fpsCap){
    lastFrame = now;
    frames++;
  }

  if(now - lastUpdate >= 1000){
    document.getElementById("fps").textContent = "FPS: " + frames;
    frames = 0;
    lastUpdate = now;
  }

  requestAnimationFrame(loop);
}

updateScale();
requestAnimationFrame(loop);

</script>
