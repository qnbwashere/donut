<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Papa's Donuteria - Optimized</title>

<style>
body{
  margin:0;
  background:#0f1115;
  font-family:system-ui;
  color:#fff;
  display:flex;
  justify-content:center;
  padding:20px;
}
#layout{
  display:flex;
  gap:20px;
  flex-wrap:wrap;
}
#game-box{
  position:relative;
  width:640px;
  height:480px;
  overflow:hidden;
  background:#000;
  border-radius:8px;
}
iframe{
  width:640px;
  height:480px;
  border:0;
  transform-origin:top left;
  display:block;
}
#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.85);
  display:flex;
  align-items:center;
  justify-content:center;
}
#overlay button{
  padding:15px 30px;
  font-size:18px;
  background:#4da3ff;
  border:none;
  cursor:pointer;
  color:#fff;
  border-radius:6px;
}
#panel{
  width:260px;
  background:#1a1d24;
  padding:15px;
  border-radius:8px;
}
.setting{
  margin-bottom:15px;
}
button{
  background:#2a2f3a;
  border:none;
  color:#fff;
  padding:6px 10px;
  margin:4px 4px 0 0;
  cursor:pointer;
  border-radius:4px;
}
button:hover{
  background:#4da3ff;
}
input[type=range]{
  width:100%;
}
.stat{
  font-size:13px;
  opacity:.7;
  margin-top:5px;
}
.low-motion *{
  animation:none !important;
  transition:none !important;
}
</style>
</head>
<body>

<div id="layout">

  <div id="game-box">
    <iframe id="game" src="about:blank" allowfullscreen></iframe>

    <div id="overlay">
      <button onclick="startGame()">Start Game</button>
    </div>
  </div>

  <div id="panel">
    <h3>Performance</h3>

    <div class="setting">
      <label>Resolution Scale</label>
      <input id="resSlider" type="range" min="0.5" max="1" step="0.01" value="1">
      <div id="resLabel">100%</div>
    </div>

    <div class="setting">
      <button onclick="autoOptimize()">Auto Optimize</button>
    </div>

    <div class="setting">
      <label>FPS Cap</label><br>
      <button onclick="setFPS(30)">30</button>
      <button onclick="setFPS(60)">60</button>
      <button onclick="setFPS(120)">120</button>
      <button onclick="setFPS(0)">Unlimited</button>
    </div>

    <div class="setting">
      <button onclick="toggleMotion()">Toggle Animations</button>
    </div>

    <div class="setting">
      <button onclick="fullscreen()">Fullscreen</button>
    </div>

    <div class="stat">FPS: <span id="fps">0</span></div>
    <div class="stat">Ping: <span id="ping">0</span> ms</div>
  </div>

</div>

<script>
const game = document.getElementById("game");
const slider = document.getElementById("resSlider");
const label = document.getElementById("resLabel");

/* -------- Start Game -------- */
function startGame(){
  game.src = "https://archive.org/embed/papasdonuteria_102";
  document.getElementById("overlay").style.display="none";
}

/* -------- Resolution Scaling -------- */
slider.addEventListener("input", function(){
  const scale = parseFloat(this.value);
  game.style.transform = "scale(" + scale + ")";
  label.textContent = Math.round(scale*100) + "%";
});

/* -------- Auto Optimize -------- */
function autoOptimize(){
  const cores = navigator.hardwareConcurrency || 2;
  const memory = navigator.deviceMemory || 2;
  const net = navigator.connection?.effectiveType || "4g";

  let scale = 1;

  if(cores <=4 || memory <=4 || net.includes("3g"))
    scale = .75;

  if(cores <=2 || memory <=2 || net.includes("2g"))
    scale = .6;

  slider.value = scale;
  game.style.transform = "scale(" + scale + ")";
  label.textContent = Math.round(scale*100) + "%";

  setFPS(60);
  document.body.classList.add("low-motion");
}

/* -------- FPS Cap + Counter -------- */
let cap = 0;
let lastFrame = 0;
let frames = 0;
let lastUpdate = performance.now();

function setFPS(limit){
  cap = limit;
}

function loop(now){
  if(!cap || now-lastFrame >= 1000/cap){
    lastFrame = now;
    frames++;
  }

  if(now-lastUpdate >=1000){
    document.getElementById("fps").textContent = frames;
    frames = 0;
    lastUpdate = now;
  }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* -------- Ping -------- */
async function ping(){
  const start = performance.now();
  try{
    await fetch("https://archive.org", {mode:"no-cors"});
    document.getElementById("ping").textContent =
      Math.round(performance.now()-start);
  }catch{
    document.getElementById("ping").textContent = "-";
  }
}
setInterval(ping,5000);
ping();

/* -------- Utilities -------- */
function toggleMotion(){
  document.body.classList.toggle("low-motion");
}

function fullscreen(){
  document.getElementById("game-box").requestFullscreen();
}
</script>

</body>
</html>
