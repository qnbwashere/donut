<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Game Optimized Embed</title>

<style>
:root{
  --bg:#0f1115;
  --panel:#1a1d24;
  --accent:#4da3ff;
  --text:#e6e6e6;
  --muted:#8a8f98;
}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:20px;
}
#frame-wrap{
  display:flex;
  gap:20px;
}
#locked-container{
  width:640px;
  height:480px;
  overflow:hidden;
  position:relative;
  background:black;
}
iframe{
  width:640px;
  height:480px;
  border:0;
  transform-origin:top left;
  display:block;
}
#start-overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.8);
  display:flex;
  align-items:center;
  justify-content:center;
}
#start-btn{
  padding:16px 30px;
  font-size:18px;
  background:var(--accent);
  border:none;
  color:white;
  cursor:pointer;
}
aside{
  background:var(--panel);
  padding:15px;
  width:280px;
  border-radius:8px;
}
.setting{
  margin-bottom:15px;
}
button{
  background:#2a2f3a;
  border:none;
  color:white;
  padding:6px 10px;
  margin:4px 4px 0 0;
  cursor:pointer;
}
button:hover{
  background:var(--accent);
}
input[type=range]{
  width:100%;
}
.stat{
  font-size:13px;
  color:var(--muted);
  margin-top:6px;
}
.low-motion *{
  animation:none !important;
  transition:none !important;
}
</style>
</head>
<body>

<div id="frame-wrap">

  <div id="locked-container">
    <iframe id="embed" src="about:blank" allowfullscreen></iframe>

    <div id="start-overlay">
      <button id="start-btn">Start Game</button>
    </div>
  </div>

  <aside>
    <h3>Performance Settings</h3>

    <div class="setting">
      <label>Resolution Scale</label>
      <input id="resolution-slider" type="range" min="0.5" max="1" step="0.01" value="1">
      <div id="resolution-label">100%</div>
    </div>

    <div class="setting">
      <button id="auto-optimize">Auto Optimize</button>
    </div>

    <div class="setting">
      <label>FPS Cap</label><br>
      <button onclick="setFPSCap(30)">30</button>
      <button onclick="setFPSCap(60)">60</button>
      <button onclick="setFPSCap(120)">120</button>
      <button onclick="setFPSCap(0)">Unlimited</button>
    </div>

    <div class="setting">
      <button onclick="toggleMotion()">Toggle Background Animations</button>
    </div>

    <div class="setting">
      <button onclick="goFullscreen()">Fullscreen</button>
    </div>

    <div class="stat">FPS: <span id="fps">0</span></div>
    <div class="stat">Ping: <span id="ping">0</span> ms</div>
  </aside>

</div>

<script>
const iframe = document.getElementById("embed");
const startBtn = document.getElementById("start-btn");
const overlay = document.getElementById("start-overlay");
const slider = document.getElementById("resolution-slider");
const label = document.getElementById("resolution-label");

startBtn.onclick = () => {
  iframe.src = "https://archive.org/embed/papasdonuteria_102";
  overlay.style.display = "none";
};

slider.addEventListener("input", () => {
  const scale = parseFloat(slider.value);
  iframe.style.transform = `scale(${scale})`;
  label.textContent = Math.round(scale*100) + "%";
});

/* ---------- AUTO OPTIMIZE ---------- */

document.getElementById("auto-optimize").onclick = () => {
  const cores = navigator.hardwareConcurrency || 2;
  const memory = navigator.deviceMemory || 2;
  const connection = navigator.connection?.effectiveType || "4g";

  let scale = 1;

  if (cores <= 4 || memory <= 4 || connection.includes("3g"))
    scale = 0.75;

  if (cores <= 2 || memory <= 2 || connection.includes("2g"))
    scale = 0.6;

  slider.value = scale;
  iframe.style.transform = `scale(${scale})`;
  label.textContent = Math.round(scale*100) + "%";

  setFPSCap(60);
  document.body.classList.add("low-motion");

  alert("Optimized for your device.");
};

/* ---------- FPS COUNTER + CAP ---------- */

let fpsCap = 0;
let lastFrame = 0;
let frameCount = 0;
let lastFPSUpdate = performance.now();

function setFPSCap(limit){
  fpsCap = limit;
}

function loop(timestamp){
  if(!fpsCap || timestamp - lastFrame >= 1000/fpsCap){
    lastFrame = timestamp;
    frameCount++;
  }

  if(timestamp - lastFPSUpdate >= 1000){
    document.getElementById("fps").textContent = frameCount;
    frameCount = 0;
    lastFPSUpdate = timestamp;
  }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- PING MONITOR ---------- */

async function measurePing(){
  const start = performance.now();
  try{
    await fetch("https://archive.org", {mode:"no-cors"});
    const ping = Math.round(performance.now() - start);
    document.getElementById("ping").textContent = ping;
  }catch{
    document.getElementById("ping").textContent = "â€”";
  }
}
setInterval(measurePing, 5000);
measurePing();

/* ---------- UTILITIES ---------- */

function toggleMotion(){
  document.body.classList.toggle("low-motion");
}

function goFullscreen(){
  document.getElementById("locked-container").requestFullscreen();
}
</script>

</body>
</html>
